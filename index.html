<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>UnixForm</title>
    <!-- Ace Editor-->
    <style type="text/css" media="screen">
      #editor {
        height: 400px;
        width: 100%;
      }
      /* .scrollmargin {
        height: 100%;
        text-align: center;
      } */
    </style>

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="./resources/bootstrap-5.0.0-beta3-dist/css/bootstrap.min.css"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="./resources/datetimepicker/jquery.datetimepicker.css"
    />
  </head>
  <body>
    <div class="container">
      <main>
        <h1>Unix Form</h1>
        <hr class="my-4" />
        <form>
          <div class="form-group">
            <label for="title">Main Title</label>
            <input
              class="form-control"
              id="mainTitle"
              placeholder="Scheduled maintenance on ..."
            />
          </div>
          <div class="form-group">
            <label for="subtitle">Service Title</label>
            <input
              class="form-control"
              id="serviceTitle"
              placeholder="Service affected on ..."
            />
          </div>
          <div class="form-group">
            <label for="subtitle">Coutesy Line</label>
            <input
              class="form-control"
              id="serviceTile"
              placeholder="We apologise for any inconvinience caused"
            />
          </div>
          <div class="form-group">
            <label for="notificationStartDateTime"
              >Notification Start Time</label
            >
            <input
              class="form-control"
              type="text"
              value=""
              id="notificationStartDateTime"
            />
          </div>
          <div class="form-group">
            <label for="notificationEndDateTime">Notification End Time</label>
            <input
              class="form-control"
              type="text"
              value=""
              id="notificationEndDateTime"
            />
          </div>
          <div class="form-group">
            <label for="preventLoginStartDateTime"
              >Prevent Login Start Time</label
            >
            <input
              class="form-control"
              type="text"
              value=""
              id="preventLoginStartDateTime"
            />
          </div>
          <div class="form-group">
            <label for="preventLoginEndDateTime">Prevent Login End Time</label>
            <input
              class="form-control"
              type="text"
              value=""
              id="preventLoginEndDateTime"
            />
          </div>

          <br />
          <input
            type="buttons"
            class="btn btn-primary"
            onclick="submitForm()"
            value="Create .json"
          />
          <br />
        </form>

        <hr class="my-4" />

        <div class="container row">
          <div class="col-10">
            <div id="editor">
              function foo(items) { var x = "All this is syntax highlighted";
              return x; }
            </div>
          </div>
          <div class="col-2">
            <input
              type="buttons"
              class="btn btn-primary"
              onclick="downloadMaintenanaceInfo()"
              value="Download"
            />
          </div>
        </div>
      </main>
    </div>
  </body>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script type="" src="./resources/jquery/jquery.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="./resources/bootstrap-5.0.0-beta3-dist/js/bootstrap.bundle.js"></script>
  <!-- Date time Js -->
  <script src="./resources/datetimepicker/jquery.datetimepicker.js"></script>

  <!-- ace -->
  <script
    src="resources/ace-builds-master/src-noconflict/ace.js"
    type="text/javascript"
    charset="utf-8"
  ></script>
  <script>
    var maintenanceInfo = {
      mainTitle: "",
      serviceTitle: "",
      notificationStartDateTime: "",
      notificationEndDateTime: ""
    }

    var editor = ace.edit("editor", {
      theme: "ace/theme/monokai",
      mode: "ace/mode/javascript",
      autoScrollEditorIntoView: true
    })
    document.getElementById("editor").style.fontSize = "16px"

    $("#notificationStartDateTime").datetimepicker()
    $("#notificationEndDateTime").datetimepicker()
    $("#preventLoginStartDateTime").datetimepicker()
    $("#preventLoginEndDateTime").datetimepicker()

    function submitForm() {
      maintenanceInfo.mainTitle = document.getElementById("mainTitle").value
      maintenanceInfo.serviceTitle = document.getElementById(
        "serviceTitle"
      ).value
      maintenanceInfo.notificationStartDateTime = Date.parse(
        document.getElementById("notificationStartDateTime").value
      ).toString()
      maintenanceInfo.notificationEndDateTime = Date.parse(
        document.getElementById("notificationEndDateTime").value
      ).toString()
      maintenanceInfo.preventLoginStartDateTime = Date.parse(
        document.getElementById("preventLoginStartDateTime").value
      ).toString()
      maintenanceInfo.preventLoginEndDateTime = Date.parse(
        document.getElementById("preventLoginEndDateTime").value
      ).toString()
      console.log(maintenanceInfo)
      updateEditorContent()
    }

    document.addEventListener("DOMContentLoaded", initlialize)

    function initlialize() {
      console.log(maintenanceInfo)

      var editor = ace.edit("editor")
      updateEditorContent()
    }

    function updateEditorContent() {
      editor.setValue(JSON.stringify(maintenanceInfo, null, 2))
    }

    function downloadMaintenanaceInfo() {
      var fileName = "maintenanceInfo.json"
      var data = editor.getValue()
      console.log(data)

      var dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(data)
      var downloadAnchorNode = document.createElement("a")
      downloadAnchorNode.setAttribute("href", dataStr)
      downloadAnchorNode.setAttribute("download", fileName)
      document.body.appendChild(downloadAnchorNode) // required for firefox
      downloadAnchorNode.click()
      downloadAnchorNode.remove()
    }
  </script>
</html>
